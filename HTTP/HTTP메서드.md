# HTTP 메서드

### API URI 설계

회원을 조회, 등록, 수정, 삭제를 하는 API 를 설계한다고 가정할 때 리소스는 무엇일까? 회원을 등록하고 수정하고 조회하는게 리소스가 아니다. 즉, 회원만 리소스이다.

우리는 API 를 설계할 때 회원 리소스를 URI 에 매핑해야 한다. 리소스를 URI 에 매핑하기 위해서는 리소스와 행위를 분리해야한다. 위 예시를 생각했을 때 회원이 리소스가 되며, 행위는 조회, 등록, 삭제, 변경인 것이다.

### HTTP 메서드의 종류

주로 사용되는 메서드는 다음 5가지이다.

- GET : 리소스를 조회한다.
- POST : 요청 데이터 처리, 주로 등록에 사용한다.
- PUT : 리소스를 대체한다. 해당 리소스가 없다면 생성한다.
- PATCH : 리소스를 일부분만 변경한다.
- DELETE : 리소스를 삭제한다.

기타 메서드에는 다음과 같은 종류가 있다.

- HEAD : GET 과 동일하지만 메시지 부분을 제외하고, 상태 줄과 헤더만 반환한다.
- OPTIONS : 대상 리소스에 대한 통신 가능 옵션을 설명한다. (주로 CORS)
- CONNECT : 대상 자원으로 식별되는 서버에 대한 터널을 설정한다.
- TRACE : 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수행

1. `GET`

- 리소스를 조회하는데 사용한다.
- 서버에 전달하고 싶은 데이터는 `query` (쿼리 파라미터, 쿼리 스트링)를 통해서 전달한다.
- 메시지 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많아서 권장하지는 않는다.

```jsx
GET /search?q=hello&hl=ko HTTP/1.1
HOST: www.google.com
```

2. `POST`

- 새 리소스 생성(등록)
- 요청 데이터 처리 (프로세스를 처리)<br>
  서버는 메시지 바디를 통해 요청 데이터를 받아서 처리한다.
- 다른 메서드로 처리하기 애매한 경우

요청 데이터 처리(b) 의 경우, 새로운 리소스를 생성하지 않을 수도 있다. 예를 들면 주운에서 결제 완료 → 배달 시작 → 배달 완료처럼 단순히 값 변경을 넘어 프로세스의 상태가 변경되는 경우가 있다. 이 경우에는 POST 의 결과로 새로운 리소스가 생성되지 않을 수도 있다.

ex) `POST /orders/{orderId}/start-delivery (컨트롤 URI)`

또한 리소스를 조회할 때 JSON 데이터를 전달이 필요한 경우에 사용할 수 있지만, 거의 사용되지 않는다.

3. `PUT`

- 리소스를 완전히 대체한다. 있다면 리소스를 대체하고, 없다면 생성한다.
- 클라이언트가 리소스를 식별해야한다. (POST 와의 차이점)
- 리소스를 수정한다기 보다는 대체하기 위해 사용한다고 생각하면 된다.

4. `PATCH`

- 리소스를 부분 변경한다.

5. `DELETE`

- 리소스 제거

### HTTP 메서드의 속성

1. **안전**

- 호출해도 리소스를 변경하지 않는다. 해당 리소스가 변하는지 여부만 고려한다.
  ex) `GET`, `HEAD`

2. **멱등 (Idempotent)**

- 한 번 호출하던 백번 호출하던 결과가 동일해야한다.
  ex) `GET`, `PUT`, `DELETE`
- `POST` 는 멱등이 아니다. 두 번 호출하면 같은 결제가 중복해서 발생할 수 있다.
- 자동 복구 매커니즘에 활용할 수 있다.
  만약 서버가 TIMEOUT 으로 정상 응답을 주지 못했을 때, 클라이언트가 다시 재요청을 보내도 되는가에 대한 판단 근거가 된다. 즉, 멱등한 요청은 두 번 요청해도 괜찮다는 의미이다.
- 멱등은 외부 요인으로 중간에 리소스가 변경되는 것까지 고려하지 않는다. A 라는 유저가 `GET` 요청으로 리소스를 조회하고, B 라는 유저가 해당 리소스에 대해 `PUT` 으로 리소스를 대체했다고 가정햐자. 다시 A 라는 유저가 리소스를 조회한다면 이전 요청과 다른 결과가 나올 것이다. 하지만 멱등성은 외부의 요인으로 중간에 리소스가 변경되는 것까지 고려하지 않기 때문에 멱등하다고 할 수 있다.

3. **캐시가능 (Cacheable)**

- 응답 결과 리소스를 캐시해서 사용해도 되는가.
- GET, HEAD, POST, PATCH 가 캐시 가능하지만 실제로는 GET, HEAD 정도만 캐시로 사용한다. POST 와 PATCH 는 본문 내용까지 캐시 키로 고려해야하기 때문에 구현이 쉽지 않다.
